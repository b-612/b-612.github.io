{"version":3,"sources":["reg-form.js"],"names":["$form","$","setPrevElems","Element","MESSAGE","document","createElement","FURTHER_ACTIONS","TEXT_WRAPPER","addClass","attr","setTryBtnCallback","click","$removingElements","$startElements","fadeOut","remove","reset","fadeIn","removeAttr","showMessage","elements","icon","messageText","furtherText","removeClass","text","append","window","util","fragment","editAndPushElements","SendParam","URL","METHOD","TIMEOUT","ON_SUCCESS","$icon","ON_ERROR","jQuery","validator","addMethod","value","element","test","validate","errorElement","errorClass","rules","name","required","minlength","phone","checkMask","messages","mask","autoclear","on","evt","preventDefault","val","invalidObj","invalid","Object","keys","$container","startHeight","height","$startContent","children","progressIcon","sendParams","formData","serializeArray","ajax","url","method","timeout","data","dataType","success","error"],"mappings":"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","sourcesContent":["'use strict';\n\n(function () {\n  const ANIMATION_TIME = 300;\n\n  const $form = $('.registration__form');\n\n  const setPrevElems = () => {\n    const Element = {\n      MESSAGE: document.createElement('span'),\n      FURTHER_ACTIONS: document.createElement('button'),\n      TEXT_WRAPPER: document.createElement('div')\n    };\n\n    $(Element.MESSAGE).addClass('registration__message');\n    $(Element.FURTHER_ACTIONS).addClass('registration__further-actions')\n      .attr('type', 'button');\n    $(Element.TEXT_WRAPPER).addClass('registration__message-text-wrapper');\n\n    return Element;\n  };\n\n  const editAndPushElements = (elements, messageText, furtherText) => {\n    $(elements.MESSAGE).text(messageText);\n    $(elements.FURTHER_ACTIONS).text(furtherText);\n    elements.TEXT_WRAPPER.append(elements.MESSAGE);\n    elements.TEXT_WRAPPER.append(elements.FURTHER_ACTIONS);\n    window.util.fragment.append(elements.TEXT_WRAPPER);\n    $('.registration .container').append(window.util.fragment).fadeIn(ANIMATION_TIME);\n  };\n\n  const onTryBtnClick = () => {\n    const $removingElements = $('.registration__send-icon, .registration__message-text-wrapper');\n    const $form = $('.registration__form')[0];\n    const $startElements = $('.registration__form, .registration__title');\n\n    $removingElements.fadeOut(ANIMATION_TIME, () => {\n      $removingElements.remove();\n      $form.reset();\n      $startElements.fadeIn(ANIMATION_TIME);\n      $('.registration .container').removeAttr('style');\n    });\n  };\n\n  const setTryBtnCallback = () => {\n    $('.registration__further-actions').click(() => {\n      onTryBtnClick();\n    });\n  };\n\n  const showMessage = (elements, icon, addClass, messageText, furtherText) => {\n    icon.removeClass('registration__send-icon--progress')\n      .addClass(addClass)\n      .fadeIn(ANIMATION_TIME);\n\n    editAndPushElements(elements, messageText, furtherText);\n    setTryBtnCallback();\n  };\n\n  const onSendSuccess = () => {\n    const elements = setPrevElems();\n    const $icon = $('.registration__send-icon');\n\n    $icon.fadeOut(ANIMATION_TIME, () => {\n      showMessage(\n        elements,\n        $icon,\n        'registration__send-icon--success',\n        'Ваша заявка была успешно отправлена',\n        'Отправить ещё одну заявку'\n      );\n    });\n  };\n\n  const onSendError = () => {\n    const elements = setPrevElems();\n    const $icon = $('.registration__send-icon');\n\n    $icon.fadeOut(ANIMATION_TIME, () => {\n      showMessage(\n        elements,\n        $icon,\n        'registration__send-icon--error',\n        'Что-то пошло не так...',\n        'Попробовать ещё раз.'\n      );\n    });\n  };\n\n  const onSubmitSend = () => {\n    const $container = $('.registration .container');\n    const startHeight = $container.height();\n    const $startContent = $container.children();\n    const progressIcon = document.createElement('div');\n\n    $container.height(startHeight);\n    $startContent.fadeOut(ANIMATION_TIME);\n    $(progressIcon).attr('class', 'registration__send-icon registration__send-icon--progress');\n    $container.append(progressIcon);\n  };\n\n  const SendParam = {\n    URL: 'https://echo.htmlacademy.ru/',\n    METHOD: 'POST',\n    TIMEOUT: 5000,\n    ON_SUCCESS: onSendSuccess,\n    ON_ERROR: onSendError\n  };\n\n  const onFormSubmit = (sendParams) => {\n    const formData = $form.serializeArray();\n\n    $.ajax({\n      url: sendParams.URL,\n      method: sendParams.METHOD,\n      timeout: sendParams.TIMEOUT,\n      data: formData,\n      dataType: 'html',\n\n      success: sendParams.ON_SUCCESS,\n      error: sendParams.ON_ERROR\n    });\n  };\n\n  const validateForm = () => {\n    jQuery.validator.addMethod(\"checkMask\", (value, element) => {\n      return /^(\\s*)?(\\+)?([- _():=+]?\\d[- _():=+]?){10,14}(\\s*)?$/.test(value);\n    });\n\n    $form.validate({\n      errorElement: \"span\",\n      errorClass: \"registration__error-message\",\n      rules: {\n        name: {\n          required: true,\n          minlength: 3\n        },\n\n        phone: {\n          checkMask: true\n        }\n      },\n\n      messages: {\n        name: {\n          required: 'Пожалуйста, укажите Ваше имя',\n          minlength: 'Имя не может быть короче 3-х символов'\n        },\n\n        phone: {\n          required: 'Введите, пожалуйста, Ваш номер телефона',\n          checkMask: 'Введите правильный номер телефона'\n        }\n      }\n    });\n\n    $('.registration__input[name=\"phone\"]')\n      .mask(\"+7 (999) 999-99-99\", {\n        autoclear: false\n      });\n  };\n\n  const setSubmitCallback = () => {\n    $form.on('submit', (evt) => {\n      evt.preventDefault();\n\n      if ($('.registration__input[name=name]').val() !== '' && $('.registration__input[name=phone]').val() !== '') {\n        const invalidObj = $('.registration__form').validate().invalid;\n        const isObjElem = invalidObj[Object.keys(invalidObj)[0]];\n\n        if (!isObjElem) {\n          onSubmitSend();\n          onFormSubmit(SendParam);\n        }\n      }\n    });\n  };\n\n  validateForm();\n  setSubmitCallback();\n})();\n"],"file":"reg-form.min.js"}